<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Seats - RailBook</title>
    <style>
        * { box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background:#f5f5f5; color:#333; }
        .container { max-width:1000px; margin:20px auto; padding:20px; }
        header { background: linear-gradient(135deg,#1a5276,#3498db); color:white; padding:12px 20px; border-radius:8px; }
        .train-header { display:flex; justify-content:space-between; align-items:center; margin-top:16px; }
    .legend { margin-top:12px; display:flex; gap:12px; align-items:center; }
    .legend .box { width:18px; height:18px; border-radius:4px; display:inline-block; margin-right:6px; }
        .seat-grid { margin-top:16px; display:flex; flex-wrap:wrap; gap:10px; }
    .seat { width:48px; height:48px; display:inline-flex; align-items:center; justify-content:center; border-radius:6px; color:white; font-weight:600; }
    /* Inverted color mapping per request: available seats are RED, booked seats are GREEN */
    .available { background:#e74c3c; }
    .unavailable { background:#27ae60; }
        .controls { margin-top:12px; display:flex; gap:12px; align-items:center; }
        .back { text-decoration:none; background:#e74c3c; color:white; padding:8px 12px; border-radius:6px; }
        select { padding:8px; font-size:14px; }
        .note { color:#666; margin-top:8px; }
        @media (max-width:600px){ .seat{ width:40px; height:40px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <strong style="font-size:18px">RailBook - Seat Map</strong>
        </header>

        <div id="content">
            <div class="train-header">
                <div>
                    <h2 id="train-title">Train</h2>
                    <div id="train-route" style="color:#555"></div>
                </div>
                <div>
                    <a href="modified.html" class="back">Back</a>
                </div>
            </div>

            <div class="controls">
                <label for="class-select">Select Class:</label>
                <select id="class-select"></select>
                <div class="legend">
                        <span class="box available"></span> Available (RED)
                        <span style="width:12px"></span>
                        <span class="box unavailable"></span> Booked (GREEN)
                    </div>
            </div>

            <div class="note">Click a seat to toggle booking (simulated local change). Red = available, Green = booked.</div>

            <div id="summary" style="margin-top:12px; color:#333;"></div>
            <div id="seat-grid" class="seat-grid"></div>
        </div>
    </div>

    <script>
        // Dataset (duplicate of modified/all-trains) - local copy
        const TRAINS = [
            { id: '12213', name: 'Rajdhani Express', number: '12213', from: 'NDLS', to: 'MUMBAI', departure: '16:25', arrival: '08:35', classes: ['1a','2a','3a'], prices: { '1a':1850, '2a':1400, '3a':900, 'sl':520 }, seatLayout: { '1a':[true,true,false,true,true,true,true,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '2a':[true,true,true,true,false,true,true,true,true,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '3a':[true,true,true,false,true,true,true,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true] } },
            { id: '12001', name: 'Shatabdi Express', number: '12001', from: 'NDLS', to: 'Bhopal', departure: '06:00', arrival: '11:30', classes: ['cc','ec'], prices: { 'cc':1250, 'ec':850 }, seatLayout: { 'cc':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], 'ec':[true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false] } },
            { id: '12245', name: 'Duronto Express', number: '12245', from: 'Kolkata', to: 'NDLS', departure: '20:05', arrival: '09:00', classes: ['1a','2a','3a'], prices: { '1a':1650, '2a':1250, '3a':900 }, seatLayout: { '1a':[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false], '2a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '3a':[true,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true] } },
            { id: '20801', name: 'Mumbai Mail', number: '20801', from: 'MUMBAI', to: 'PUNE', departure: '09:00', arrival: '12:30', classes: ['3a','sl'], prices: { '3a':600, 'sl':250 }, seatLayout: { '3a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], 'sl':[true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false] } },
            { id: '12657', name: 'Bengaluru Express', number: '12657', from: 'Bangalore', to: 'Chennai', departure: '07:15', arrival: '13:50', classes: ['2a','3a','sl'], prices: { '2a':1100, '3a':750, 'sl':320 }, seatLayout: { '2a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '3a':[true,true,true,true,true,true,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], 'sl':[true,true,false,true,true,true,false,true,true,true,false,true,true,true,false,true,true,true,false,true,true,true,true,true] } },
            { id: '12777', name: 'Hyderabad Express', number: '12777', from: 'Hyderabad', to: 'Bangalore', departure: '14:40', arrival: '21:10', classes: ['3a','sl'], prices: { '3a':680, 'sl':300 }, seatLayout: { '3a':[true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true,false], 'sl':[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false] } },
            { id: '12901', name: 'Gujarat Mail', number: '12901', from: 'Ahmedabad', to: 'Mumbai', departure: '23:55', arrival: '07:40', classes: ['1a','2a','3a','sl'], prices: { '1a':2000, '2a':1500, '3a':1000, 'sl':450 }, seatLayout: { '1a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '2a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '3a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], 'sl':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true] } },
            { id: '13007', name: 'Kochi Express', number: '13007', from: 'Kochi', to: 'Bangalore', departure: '05:30', arrival: '12:10', classes: ['2a','3a','sl'], prices: { '2a':1200, '3a':800, 'sl':340 }, seatLayout: { '2a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], '3a':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true], 'sl':[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true] } }
        ];

        function qs(name){
            return new URLSearchParams(window.location.search).get(name);
        }

        const trainParam = qs('train');
        const train = TRAINS.find(t => t.number === trainParam || t.id === trainParam);

        const title = document.getElementById('train-title');
        const route = document.getElementById('train-route');
        const classSelect = document.getElementById('class-select');
        const seatGrid = document.getElementById('seat-grid');

        if (!train) {
            title.textContent = 'Train not found';
            route.textContent = '';
            classSelect.style.display = 'none';
            seatGrid.innerHTML = '<p style="padding:12px; background:#fff; border-radius:8px; box-shadow:0 3px 8px rgba(0,0,0,0.06)">Train not found. Go back to <a href="modified.html">home</a>.</p>';
        } else {
            title.textContent = `${train.name} (${train.number})`;
            route.textContent = `${train.from} → ${train.to} • Departure: ${train.departure} • Arrival: ${train.arrival}`;

            // populate class select
            train.classes.forEach(c => {
                const opt = document.createElement('option'); opt.value = c; opt.textContent = c.toUpperCase();
                classSelect.appendChild(opt);
            });

            // default class
            let currentClass = train.classes[0];

            function renderSeatsForClass(cls) {
                seatGrid.innerHTML = '';
                const layout = (train.seatLayout && train.seatLayout[cls]) || [];
                const total = layout.length || 0;
                if (total === 0) {
                    seatGrid.innerHTML = '<p>No seat layout available for this class.</p>';
                    document.getElementById('summary').textContent = '';
                    return;
                }

                // compute counts: in our data true = available
                const availableCount = layout.filter(Boolean).length;
                const bookedCount = total - availableCount;
                document.getElementById('summary').innerHTML = `<strong>Seats:</strong> ${total} &nbsp; • &nbsp; <strong style="color:#e74c3c">Available</strong>: ${availableCount} &nbsp; • &nbsp; <strong style="color:#27ae60">Booked</strong>: ${bookedCount}`;

                for (let i=0;i<total;i++){
                    const s = document.createElement('div');
                    // layout[i] true => available (display as RED per request)
                    s.className = 'seat ' + (layout[i] ? 'available' : 'unavailable');
                    s.textContent = i+1;
                    // toggle local state on click
                    s.addEventListener('click', ()=>{
                        layout[i] = !layout[i];
                        s.className = 'seat ' + (layout[i] ? 'available' : 'unavailable');
                        // update counts
                        const av = layout.filter(Boolean).length;
                        const bk = layout.length - av;
                        document.getElementById('summary').innerHTML = `<strong>Seats:</strong> ${layout.length} &nbsp; • &nbsp; <strong style="color:#e74c3c">Available</strong>: ${av} &nbsp; • &nbsp; <strong style="color:#27ae60">Booked</strong>: ${bk}`;
                    });
                    seatGrid.appendChild(s);
                }
            }

            classSelect.addEventListener('change', (e)=>{
                currentClass = e.target.value;
                renderSeatsForClass(currentClass);
            });

            // render first class
            renderSeatsForClass(currentClass);
        }
    </script>
</body>
</html>